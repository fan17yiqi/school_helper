(()=>{"use strict";var t={2388:(t,e,s)=>{var r=s(5471),a=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},i=[];const l={name:"App"},o=l;var n=s(1656),c=(0,n.A)(o,a,i,!1,null,null,null);const u=c.exports;var d=s(173),p=function(){var t=this,e=t._self._c;return e("Layout",[e("div",{staticClass:"home-page"},[e("div",{staticClass:"filter-banner"},[e("div",{staticClass:"filter-container"},[e("div",{staticClass:"filter-section"},[e("div",{staticClass:"filter-title"},[e("i",{staticClass:"el-icon-menu"}),e("span",[t._v("商品分类")])]),e("el-radio-group",{staticClass:"category-buttons",attrs:{size:"medium"},on:{change:t.loadProducts},model:{value:t.selectedCategory,callback:function(e){t.selectedCategory=e},expression:"selectedCategory"}},[e("el-radio-button",{attrs:{label:""}},[e("i",{staticClass:"el-icon-s-grid"}),t._v(" 全部 ")]),e("el-radio-button",{attrs:{label:"二手书"}},[e("i",{staticClass:"el-icon-reading"}),t._v(" 二手书 ")]),e("el-radio-button",{attrs:{label:"生活用品"}},[e("i",{staticClass:"el-icon-shopping-bag-1"}),t._v(" 生活用品 ")]),e("el-radio-button",{attrs:{label:"历年卷"}},[e("i",{staticClass:"el-icon-document"}),t._v(" 历年卷 ")])],1)],1),t.user?e("div",{staticClass:"publish-section"},[e("el-button",{staticClass:"publish-btn",attrs:{type:"primary",icon:"el-icon-plus",size:"medium"},on:{click:function(e){return t.$router.push("/product/publish")}}},[t._v(" 发布商品 ")])],1):t._e()])]),e("div",{staticClass:"products-grid"},t._l(t.products,function(s){return e("el-card",{key:s.id,staticClass:"product-card",attrs:{shadow:"hover"},nativeOn:{click:function(e){return t.$router.push(`/product/${s.id}`)}}},[e("div",{staticClass:"product-image"},[t.getFirstImage(s.images)?e("img",{attrs:{src:t.getFirstImage(s.images),alt:"商品图片"}}):e("div",{staticClass:"no-image"},[e("i",{staticClass:"el-icon-picture"}),e("p",[t._v("暂无图片")])])]),e("div",{staticClass:"product-info"},[e("h3",{staticClass:"product-title"},[t._v(t._s(s.title))]),e("div",{staticClass:"product-price"},[t._v("¥"+t._s(s.price))]),e("div",{staticClass:"product-meta"},[e("el-tag",{attrs:{size:"mini",type:"info"}},[t._v(t._s(s.category))]),e("el-tag",{attrs:{size:"mini",type:"自提"===s.tradeType?"success":"warning"}},[t._v(" "+t._s(s.tradeType)+" ")])],1)])])}),1),0===t.products.length?e("el-empty",{attrs:{description:"暂无商品"}}):t._e()],1)])},h=[],m=function(){var t=this,e=t._self._c;return e("div",{staticClass:"layout-container"},[e("el-header",{staticClass:"main-header"},[e("div",{staticClass:"header-content"},[e("div",{staticClass:"logo-section",on:{click:function(e){return t.$router.push("/")}}},[e("img",{staticClass:"logo-img",attrs:{src:t.logoUrl,alt:"校徽"},on:{error:t.handleImageError}}),e("span",{staticClass:"site-title"},[t._v("校园二手交易平台")])]),e("div",{staticClass:"nav-section"},[e("el-menu",{staticClass:"main-menu",attrs:{"default-active":t.activeMenu,mode:"horizontal"},on:{select:t.handleMenuSelect}},[e("el-menu-item",{attrs:{index:"products"}},[t._v("商品")]),e("el-menu-item",{attrs:{index:"helps"}},[t._v("求助")]),t.user?e("el-menu-item",{attrs:{index:"publish"}},[t._v("发布")]):t._e(),t.user?e("el-menu-item",{attrs:{index:"chats"}},[t._v("消息")]):t._e()],1)],1),e("div",{staticClass:"user-section"},[t.user?t._e():e("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.$router.push("/login")}}},[t._v("登录")]),t.user?t._e():e("el-button",{attrs:{size:"small"},on:{click:function(e){return t.$router.push("/register")}}},[t._v("注册")]),t.user?e("el-dropdown",{attrs:{trigger:"click"},on:{command:t.handleCommand}},[e("span",{staticClass:"user-info"},[e("i",{staticClass:"el-icon-user"}),t._v(" "+t._s(t.user.realName)+" "),e("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",{attrs:{command:"center"}},[t._v("个人中心")]),e("el-dropdown-item",{attrs:{command:"my-products"}},[t._v("我的商品")]),e("el-dropdown-item",{attrs:{command:"my-helps"}},[t._v("我的求助")]),e("el-dropdown-item",{attrs:{divided:"",command:"logout"}},[t._v("退出登录")])],1)],1):t._e()],1)])]),e("el-main",{staticClass:"main-content"},[t._t("default")],2)],1)},g=[];const v={name:"Layout",data(){return{user:null,logoUrl:"/4103920fcb585969e77a189b4f342387.png"}},computed:{activeMenu(){const t=this.$route.path;return t.startsWith("/product")?"products":t.startsWith("/help")?"helps":t.startsWith("/chat")?"chats":t.includes("publish")?"publish":"products"}},mounted(){this.user=JSON.parse(localStorage.getItem("user")||"null")},watch:{$route(){this.user=JSON.parse(localStorage.getItem("user")||"null")}},methods:{handleMenuSelect(t){"products"===t?this.$router.push("/"):"helps"===t?this.$router.push("/helps"):"publish"===t?this.$router.push("/product/publish"):"chats"===t&&this.$router.push("/chats")},handleCommand(t){"center"===t?this.$router.push("/user/center"):"my-products"===t?this.$router.push("/user/center?tab=products"):"my-helps"===t?this.$router.push("/user/center?tab=helps"):"logout"===t&&(localStorage.removeItem("user"),localStorage.removeItem("token"),this.user=null,this.$message.success("已退出登录"),this.$router.push("/"))},handleImageError(){this.logoUrl="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTA%2FJSIgeT0iNTAlJSIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPuaXoOWbvueJhzwvdGV4dD48L3N2Zz4="}}},f=v;var y=(0,n.A)(f,m,g,!1,null,"22c19b6c",null);const b=y.exports,_={name:"Home",components:{Layout:b},data(){return{products:[],selectedCategory:"",user:null}},mounted(){this.user=JSON.parse(localStorage.getItem("user")||"null"),this.loadProducts()},methods:{loadProducts(){const t=this.selectedCategory?{category:this.selectedCategory}:{};this.$http.get("/product/list",{params:t}).then(t=>{t.success&&(this.products=t.data)})},getFirstImage(t){if(!t)return null;try{const e=JSON.parse(t);if(e.length>0){let t=e[0];return t&&"string"===typeof t?(t.startsWith("http")||t.startsWith("/")||(t="/"+t),t.startsWith("/uploads/"),t):null}return null}catch{return null}}}},C=_;var w=(0,n.A)(C,p,h,!1,null,"f1bc7112",null);const $=w.exports;var I=function(){var t=this,e=t._self._c;return e("div",{staticClass:"login-container"},[e("el-card",{staticClass:"login-card"},[e("div",{staticClass:"logo-container"},[e("img",{staticClass:"school-logo",attrs:{src:t.logoUrl,alt:"校徽"}})]),e("h2",[t._v("用户登录")]),e("el-form",{ref:"loginForm",attrs:{model:t.loginForm,rules:t.rules,"label-width":"80px"}},[e("el-form-item",{attrs:{label:"用户名",prop:"username"}},[e("el-input",{attrs:{placeholder:"请输入用户名"},model:{value:t.loginForm.username,callback:function(e){t.$set(t.loginForm,"username",e)},expression:"loginForm.username"}})],1),e("el-form-item",{attrs:{label:"密码",prop:"password"}},[e("el-input",{attrs:{type:"password",placeholder:"请输入密码"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleLogin.apply(null,arguments)}},model:{value:t.loginForm.password,callback:function(e){t.$set(t.loginForm,"password",e)},expression:"loginForm.password"}})],1),e("el-form-item",[e("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:t.handleLogin}},[t._v("登录")])],1),e("el-form-item",[e("el-link",{attrs:{type:"primary"},on:{click:function(e){return t.$router.push("/register")}}},[t._v("还没有账号？立即注册")])],1)],1)],1)],1)},k=[];const P={name:"Login",data(){return{logoUrl:"/4103920fcb585969e77a189b4f342387.png",loginForm:{username:"",password:""},rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]}}},methods:{handleLogin(){this.$refs.loginForm.validate(t=>{t&&this.$http.post("/user/login",this.loginForm).then(t=>{t.success?(localStorage.setItem("user",JSON.stringify(t.data)),localStorage.setItem("token","token_"+t.data.id),this.$message.success("登录成功"),this.$router.push("/")):this.$message.error(t.message)}).catch(t=>{this.$message.error("登录失败："+(t.message||"网络错误"))})})}}},M=P;var S=(0,n.A)(M,I,k,!1,null,"5696257b",null);const F=S.exports;var x=function(){var t=this,e=t._self._c;return e("div",{staticClass:"register-container"},[e("el-card",{staticClass:"register-card"},[e("h2",[t._v("用户注册")]),e("el-form",{ref:"registerForm",attrs:{model:t.registerForm,rules:t.rules,"label-width":"100px"}},[e("el-form-item",{attrs:{label:"用户名",prop:"username"}},[e("el-input",{attrs:{placeholder:"请输入用户名"},model:{value:t.registerForm.username,callback:function(e){t.$set(t.registerForm,"username",e)},expression:"registerForm.username"}})],1),e("el-form-item",{attrs:{label:"密码",prop:"password"}},[e("el-input",{attrs:{type:"password",placeholder:"请输入密码"},model:{value:t.registerForm.password,callback:function(e){t.$set(t.registerForm,"password",e)},expression:"registerForm.password"}})],1),e("el-form-item",{attrs:{label:"确认密码",prop:"confirmPassword"}},[e("el-input",{attrs:{type:"password",placeholder:"请再次输入密码"},model:{value:t.registerForm.confirmPassword,callback:function(e){t.$set(t.registerForm,"confirmPassword",e)},expression:"registerForm.confirmPassword"}})],1),e("el-form-item",{attrs:{label:"真实姓名",prop:"realName"}},[e("el-input",{attrs:{placeholder:"请输入真实姓名"},model:{value:t.registerForm.realName,callback:function(e){t.$set(t.registerForm,"realName",e)},expression:"registerForm.realName"}})],1),e("el-form-item",{attrs:{label:"学号",prop:"studentId"}},[e("el-input",{attrs:{placeholder:"请输入学号"},model:{value:t.registerForm.studentId,callback:function(e){t.$set(t.registerForm,"studentId",e)},expression:"registerForm.studentId"}})],1),e("el-form-item",{attrs:{label:"手机号",prop:"phone"}},[e("el-input",{attrs:{placeholder:"请输入手机号"},model:{value:t.registerForm.phone,callback:function(e){t.$set(t.registerForm,"phone",e)},expression:"registerForm.phone"}})],1),e("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[e("el-input",{attrs:{placeholder:"请输入邮箱"},model:{value:t.registerForm.email,callback:function(e){t.$set(t.registerForm,"email",e)},expression:"registerForm.email"}})],1),e("el-form-item",[e("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:t.handleRegister}},[t._v("注册")])],1),e("el-form-item",[e("el-link",{attrs:{type:"primary"},on:{click:function(e){return t.$router.push("/login")}}},[t._v("已有账号？立即登录")])],1)],1)],1)],1)},L=[];const T={name:"Register",data(){const t=(t,e,s)=>{e!==this.registerForm.password?s(new Error("两次输入密码不一致")):s()};return{registerForm:{username:"",password:"",confirmPassword:"",realName:"",studentId:"",phone:"",email:""},rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能少于6个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:t,trigger:"blur"}],realName:[{required:!0,message:"请输入真实姓名",trigger:"blur"}],studentId:[{required:!0,message:"请输入学号",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]}}},methods:{handleRegister(){this.$refs.registerForm.validate(t=>{if(t){const{confirmPassword:t,...e}=this.registerForm;this.$http.post("/user/register",e).then(t=>{t.success?(this.$message.success("注册成功，请登录"),this.$router.push("/login")):this.$message.error(t.message)}).catch(t=>{this.$message.error("注册失败："+(t.message||"网络错误"))})}})}}},A=T;var U=(0,n.A)(A,x,L,!1,null,"4763af9c",null);const N=U.exports;var O=function(){var t=this,e=t._self._c;return e("div",{staticClass:"product-list"},[e("el-container",[e("el-header",[e("div",{staticClass:"header-content"},[e("h2",[t._v("商品列表")]),e("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(e){return t.$router.push("/product/publish")}}},[t._v("发布商品")])],1)]),e("el-main",[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:6}},[e("el-card",[e("h3",[t._v("分类筛选")]),e("el-radio-group",{on:{change:t.loadProducts},model:{value:t.selectedCategory,callback:function(e){t.selectedCategory=e},expression:"selectedCategory"}},[e("el-radio",{attrs:{label:""}},[t._v("全部")]),e("el-radio",{attrs:{label:"二手书"}},[t._v("二手书")]),e("el-radio",{attrs:{label:"生活用品"}},[t._v("生活用品")]),e("el-radio",{attrs:{label:"历年卷"}},[t._v("历年卷")])],1)],1)],1),e("el-col",{attrs:{span:18}},[e("el-row",{attrs:{gutter:20}},t._l(t.products,function(s){return e("el-col",{key:s.id,staticStyle:{"margin-bottom":"20px"},attrs:{span:8}},[e("el-card",{staticClass:"product-card",nativeOn:{click:function(e){return t.$router.push(`/product/${s.id}`)}}},[e("div",{staticClass:"product-image"},[t.getFirstImage(s.images)?e("img",{attrs:{src:t.getFirstImage(s.images),alt:"商品图片"}}):e("div",{staticClass:"no-image"},[t._v("暂无图片")])]),e("div",{staticClass:"product-info"},[e("h3",[t._v(t._s(s.title))]),e("p",{staticClass:"price"},[t._v("¥"+t._s(s.price))]),e("p",{staticClass:"category"},[t._v(t._s(s.category))]),e("p",{staticClass:"trade-type"},[t._v(t._s("自提"===s.tradeType?"自提":"送达"))])])])],1)}),1),0===t.products.length?e("el-empty",{attrs:{description:"暂无商品"}}):t._e()],1)],1)],1)],1)],1)},D=[];const W={name:"ProductList",data(){return{products:[],selectedCategory:""}},mounted(){this.loadProducts()},methods:{loadProducts(){const t=this.selectedCategory?{category:this.selectedCategory}:{};this.$http.get("/product/list",{params:t}).then(t=>{t.success&&(this.products=t.data)})},getFirstImage(t){if(!t)return null;try{const e=JSON.parse(t);if(e.length>0){let t=e[0];return t&&"string"===typeof t?(t.startsWith("http")||t.startsWith("/")||(t="/"+t),t.startsWith("/uploads/"),t):null}return null}catch{return null}}}},z=W;var H=(0,n.A)(z,O,D,!1,null,"7b342b72",null);const q=H.exports;var J=function(){var t=this,e=t._self._c;return e("Layout",[t.product?e("div",{staticClass:"product-detail-page"},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:12}},[e("el-card",[t.productImages.length>0?e("el-carousel",{attrs:{height:"500px"}},t._l(t.productImages,function(t,s){return e("el-carousel-item",{key:s},[e("img",{staticStyle:{width:"100%",height:"100%","object-fit":"contain"},attrs:{src:t}})])}),1):e("div",{staticClass:"no-image-large"},[e("i",{staticClass:"el-icon-picture"}),e("p",[t._v("暂无图片")])])],1)],1),e("el-col",{attrs:{span:12}},[e("el-card",[e("h1",{staticClass:"product-title"},[t._v(t._s(t.product.title))]),e("div",{staticClass:"product-price-large"},[t._v("¥"+t._s(t.product.price))]),e("el-divider"),e("div",{staticClass:"info-row"},[e("span",{staticClass:"info-label"},[t._v("分类：")]),e("el-tag",[t._v(t._s(t.product.category))])],1),e("div",{staticClass:"info-row"},[e("span",{staticClass:"info-label"},[t._v("交易方式：")]),e("el-tag",{attrs:{type:"自提"===t.product.tradeType?"success":"warning"}},[t._v(" "+t._s(t.product.tradeType)+" ")])],1),"送达"===t.product.tradeType&&t.deliveryPoint?e("div",{staticClass:"info-row"},[e("span",{staticClass:"info-label"},[t._v("送达地点：")]),e("span",[t._v(t._s(t.deliveryPoint.name)+" - "+t._s(t.deliveryPoint.address))])]):t._e(),e("div",{staticClass:"info-row"},[e("span",{staticClass:"info-label"},[t._v("状态：")]),e("el-tag",{attrs:{type:0===t.product.status?"success":"info"}},[t._v(" "+t._s(0===t.product.status?"待售":1===t.product.status?"已售":"已下架")+" ")])],1),e("el-divider"),e("h3",[t._v("商品描述")]),e("div",{staticClass:"product-description"},[t._v(t._s(t.product.description))]),e("el-divider"),e("div",{staticClass:"action-buttons"},[e("el-button",{attrs:{type:"primary",size:"large",icon:"el-icon-message",disabled:0!==t.product.status||t.isOwner},on:{click:t.contactSeller}},[t._v(" "+t._s(t.isOwner?"这是您发布的商品":0===t.product.status?"联系卖家":"商品已售")+" ")])],1)],1)],1)],1)],1):t._e()])},E=[];const j={name:"ProductDetail",components:{Layout:b},data(){return{product:null,deliveryPoint:null,productImages:[],user:null}},computed:{isOwner(){return this.user&&this.product&&this.user.id===this.product.userId}},mounted(){this.user=JSON.parse(localStorage.getItem("user")||"null"),this.loadProduct()},methods:{loadProduct(){const t=this.$route.params.id;if(!t||"publish"===t)return this.$message.error("商品ID无效"),void this.$router.push("/");this.$http.get(`/product/${t}`).then(t=>{if(t.success){if(this.product=t.data,this.product.images)try{const t=JSON.parse(this.product.images);this.productImages=t.filter(t=>t&&"string"===typeof t&&""!==t.trim()).map(t=>(t.startsWith("http")||t.startsWith("/")||(t="/"+t),t.startsWith("/uploads/"),t))}catch{this.productImages=[]}this.product.deliveryPointId&&this.loadDeliveryPoint(this.product.deliveryPointId)}})},loadDeliveryPoint(t){this.$http.get(`/delivery/${t}`).then(t=>{t.success&&(this.deliveryPoint=t.data)})},contactSeller(){if(!this.user)return this.$message.warning("请先登录"),void this.$router.push("/login");this.$router.push({path:`/chat/${this.product.userId}`,query:{productId:this.product.id}})}}},R=j;var Z=(0,n.A)(R,J,E,!1,null,"47726400",null);const B=Z.exports;var G=function(){var t=this,e=t._self._c;return e("Layout",[e("div",{staticClass:"product-publish-wrapper"},[e("div",{staticClass:"product-publish"},[e("el-card",[e("div",{attrs:{slot:"header"},slot:"header"},[e("h2",[t._v("发布商品")])]),e("el-form",{ref:"productForm",staticStyle:{"max-width":"800px"},attrs:{model:t.productForm,rules:t.rules,"label-width":"120px"}},[e("el-form-item",{attrs:{label:"商品标题",prop:"title"}},[e("el-input",{attrs:{placeholder:"请输入商品标题"},model:{value:t.productForm.title,callback:function(e){t.$set(t.productForm,"title",e)},expression:"productForm.title"}})],1),e("el-form-item",{attrs:{label:"商品分类",prop:"category"}},[e("el-select",{attrs:{placeholder:"请选择分类"},model:{value:t.productForm.category,callback:function(e){t.$set(t.productForm,"category",e)},expression:"productForm.category"}},[e("el-option",{attrs:{label:"二手书",value:"二手书"}}),e("el-option",{attrs:{label:"生活用品",value:"生活用品"}}),e("el-option",{attrs:{label:"历年卷",value:"历年卷"}})],1)],1),e("el-form-item",{attrs:{label:"商品描述",prop:"description"}},[e("el-input",{attrs:{type:"textarea",rows:5,placeholder:"请输入商品详细描述"},model:{value:t.productForm.description,callback:function(e){t.$set(t.productForm,"description",e)},expression:"productForm.description"}})],1),e("el-form-item",{attrs:{label:"价格",prop:"price"}},[e("el-input-number",{attrs:{min:0,precision:2,placeholder:"请输入价格"},model:{value:t.productForm.price,callback:function(e){t.$set(t.productForm,"price",e)},expression:"productForm.price"}})],1),e("el-form-item",{attrs:{label:"交易方式",prop:"tradeType"}},[e("el-radio-group",{model:{value:t.productForm.tradeType,callback:function(e){t.$set(t.productForm,"tradeType",e)},expression:"productForm.tradeType"}},[e("el-radio",{attrs:{label:"自提"}},[t._v("自提")]),e("el-radio",{attrs:{label:"送达"}},[t._v("送达")])],1)],1),"送达"===t.productForm.tradeType?e("el-form-item",{attrs:{label:"送达地点",prop:"deliveryPointId"}},[e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.showMapDialog=!0}}},[t._v("选择送达地点")]),t.selectedDeliveryPoint?e("div",{staticStyle:{"margin-top":"10px"}},[e("el-tag",[t._v(t._s(t.selectedDeliveryPoint.name)+" - "+t._s(t.selectedDeliveryPoint.address))])],1):t._e()],1):t._e(),e("el-form-item",{attrs:{label:"商品图片"}},[e("el-upload",{attrs:{action:"/api/file/upload","list-type":"picture-card","file-list":t.fileList,"on-preview":t.handlePreview,"on-remove":t.handleRemove,"on-success":t.handleUploadSuccess,"on-error":t.handleUploadError,"before-upload":t.beforeUpload,limit:5}},[e("i",{staticClass:"el-icon-plus"})])],1),e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:t.handleSubmit}},[t._v("发布")]),e("el-button",{on:{click:function(e){return t.$router.back()}}},[t._v("取消")])],1)],1)],1)],1),e("el-dialog",{attrs:{title:"选择送达地点",visible:t.showMapDialog,width:"80%","before-close":t.handleMapClose},on:{"update:visible":function(e){t.showMapDialog=e}}},[e("MapPicker",{attrs:{"delivery-points":t.deliveryPoints},on:{select:t.handleMapSelect}})],1)],1)])},K=[],Q=function(){var t=this,e=t._self._c;return e("div",{staticClass:"map-picker"},[e("div",{staticStyle:{width:"100%",height:"500px"},attrs:{id:"map-container"}}),e("div",{staticClass:"point-list"},[e("h3",[t._v("选择送达地点")]),e("el-radio-group",{staticStyle:{width:"100%"},on:{change:t.handlePointChange},model:{value:t.selectedPointId,callback:function(e){t.selectedPointId=e},expression:"selectedPointId"}},t._l(t.deliveryPoints,function(s){return e("div",{key:s.id,staticClass:"point-item"},[e("el-radio",{attrs:{label:s.id}},[e("div",{staticClass:"point-info"},[e("div",{staticClass:"point-name"},[t._v(t._s(s.name))]),e("div",{staticClass:"point-address"},[t._v(t._s(s.address))])])])],1)}),0),0===t.deliveryPoints.length?e("el-empty",{attrs:{description:"暂无送达地点"}}):t._e(),e("el-button",{staticStyle:{"margin-top":"20px",width:"100%"},attrs:{type:"primary"},on:{click:t.handleConfirm}},[t._v("确认选择")])],1)])},V=[];const X={name:"MapPicker",props:{deliveryPoints:{type:Array,default:()=>[]}},data(){return{map:null,markers:[],defaultMarker:null,selectedPointId:null,selectedPoint:null,amapKey:"f4bd907075e26632db123ab93c643986"}},mounted(){this.initMap()},watch:{deliveryPoints:{handler(){this.updateMarkers()},deep:!0}},methods:{initMap(){if(window.AMap)return void this.createMap();const t=document.createElement("script");t.src=`https://webapi.amap.com/maps?v=1.4.15&key=${this.amapKey}&callback=initAMap`,t.async=!0,t.defer=!0,window.initAMap=()=>{this.createMap()},t.onerror=()=>{this.$message.error("地图加载失败，请检查 API Key 是否正确"),console.error("高德地图加载失败，请检查："),console.error("1. API Key 是否正确"),console.error("2. 是否在 https://console.amap.com/dev/key/app 申请了 key"),console.error("3. 是否设置了正确的域名白名单")},document.head.appendChild(t)},createMap(){if(!window.AMap)return void console.error("高德地图 API 未加载");const t=[119.2,26.05];this.map=new AMap.Map("map-container",{zoom:15,center:t,mapStyle:"amap://styles/normal"}),this.addDefaultMarker(t),AMap.plugin("AMap.Geocoder",()=>{const e=new AMap.Geocoder({city:"福州市"});e.getLocation("福州大学旗山校区",(e,s)=>{if("complete"===e&&s.geocodes&&s.geocodes.length>0){const t=s.geocodes[0].location,e=[t.lng,t.lat];console.log("地理编码成功，福州大学旗山校区坐标:",e),this.map.setCenter(e),this.map.setZoom(15),this.defaultMarker?this.defaultMarker.setPosition(e):this.addDefaultMarker(e)}else console.warn("地理编码失败，使用默认坐标:",t)})}),this.updateMarkers(),this.map.on("click",t=>{const{lng:e,lat:s}=t.lnglat;console.log("点击位置:",e,s)})},addDefaultMarker(t){if(this.defaultMarker)this.defaultMarker.setPosition(t);else{this.defaultMarker=new AMap.Marker({position:t,title:"福州大学旗山校区",map:this.map});const e=new AMap.InfoWindow({content:'<div style="padding: 10px;"><b>福州大学旗山校区</b><br><span style="color: #666; font-size: 12px;">福州市闽侯县上街镇学园路2号</span></div>'});this.defaultMarker.on("click",()=>{e.open(this.map,t)})}},updateMarkers(){this.map&&window.AMap&&(this.map.remove(this.markers),this.markers=[],this.deliveryPoints&&this.deliveryPoints.length>0&&(this.deliveryPoints.forEach(t=>{if(t.longitude&&t.latitude){const e=new AMap.Marker({position:[t.longitude,t.latitude],title:t.name,map:this.map}),s=`\n              <div style="padding: 10px;">\n                <b>${t.name}</b><br>\n                <span style="color: #666; font-size: 12px;">${t.address}</span>\n              </div>\n            `,r=new AMap.InfoWindow({content:s});e.on("click",()=>{this.selectedPointId=t.id,this.selectedPoint=t,r.open(this.map,[t.longitude,t.latitude])}),this.markers.push(e)}}),this.markers.length>0&&this.map.setFitView(this.markers,!1,[50,50,50,50])))},handlePointChange(t){this.selectedPoint=this.deliveryPoints.find(e=>e.id===t),this.selectedPoint&&this.map&&this.selectedPoint.longitude&&this.selectedPoint.latitude&&(this.map.setCenter([this.selectedPoint.longitude,this.selectedPoint.latitude]),this.map.setZoom(16),this.markers.forEach(e=>{const s=this.deliveryPoints.find(t=>Math.abs(t.longitude-e.getPosition().lng)<1e-4&&Math.abs(t.latitude-e.getPosition().lat)<1e-4);s&&s.id===t&&e.emit("click",{target:e})}))},handleConfirm(){this.selectedPoint?this.$emit("select",this.selectedPoint):this.$message.warning("请选择一个送达地点")}},beforeDestroy(){this.map&&(this.map.destroy(),this.map=null)}},Y=X;var tt=(0,n.A)(Y,Q,V,!1,null,"d1967152",null);const et=tt.exports,st={components:{Layout:b,MapPicker:et},name:"ProductPublish",data(){return{productForm:{title:"",category:"",description:"",price:0,tradeType:"自提",deliveryPointId:null},rules:{title:[{required:!0,message:"请输入商品标题",trigger:"blur"}],category:[{required:!0,message:"请选择分类",trigger:"change"}],description:[{required:!0,message:"请输入商品描述",trigger:"blur"}],price:[{required:!0,message:"请输入价格",trigger:"blur"}],tradeType:[{required:!0,message:"请选择交易方式",trigger:"change"}]},fileList:[],showMapDialog:!1,selectedDeliveryPoint:null,deliveryPoints:[]}},mounted(){this.loadDeliveryPoints();const t=JSON.parse(localStorage.getItem("user")||"null");t||(this.$message.warning("请先登录"),this.$router.push("/login"))},methods:{loadDeliveryPoints(){this.$http.get("/delivery/list").then(t=>{t.success&&(this.deliveryPoints=t.data)})},handleMapSelect(t){this.selectedDeliveryPoint=t,this.productForm.deliveryPointId=t.id,this.showMapDialog=!1},handleMapClose(){this.showMapDialog=!1},handlePreview(t){window.open(t.url||t.response?.url,"_blank")},handleRemove(t,e){this.fileList=e},beforeUpload(t){const e=t.type.startsWith("image/"),s=t.size/1024/1024<5;return e?!!s||(this.$message.error("图片大小不能超过 5MB!"),!1):(this.$message.error("只能上传图片文件!"),!1)},handleUploadSuccess(t,e,s){if(t.success){let r=t.url;r.startsWith("/uploads/"),0,this.fileList=s.map(s=>s.uid===e.uid?{...s,url:r,response:t}:s),this.$message.success("图片上传成功")}else this.$message.error(t.message||"上传失败"),this.fileList=s.filter(t=>t.uid!==e.uid)},handleUploadError(t,e,s){this.$message.error("图片上传失败："+(t.message||"网络错误")),this.fileList=s.filter(t=>t.uid!==e.uid)},handleSubmit(){this.$refs.productForm.validate(t=>{if(t){if("送达"===this.productForm.tradeType&&!this.productForm.deliveryPointId)return void this.$message.warning("请选择送达地点");const t=JSON.parse(localStorage.getItem("user")||"null"),e=this.fileList.map(t=>{const e=t.response?.url;if(e&&!e.startsWith("blob:")&&!e.startsWith("http://"))return e;if(e&&e.startsWith("http://47.108.59.70:8090/uploads/"))return e.replace("http://47.108.59.70:8090","");const s=t.url;return s&&s.startsWith("http://47.108.59.70:8090/uploads/")?s.replace("http://47.108.59.70:8090",""):!s||s.startsWith("blob:")||s.startsWith("http://")?"":s}).filter(t=>t&&""!==t.trim());if(0===e.length)return void this.$message.warning("请至少上传一张商品图片");const s={...this.productForm,userId:t.id,images:JSON.stringify(e)};this.$http.post("/product/add",s).then(t=>{t.success?(this.$message.success("发布成功"),this.$router.push("/")):this.$message.error(t.message)})}})}}},rt=st;var at=(0,n.A)(rt,G,K,!1,null,"0d2e506a",null);const it=at.exports;var lt=function(){var t=this,e=t._self._c;return e("Layout",[e("div",{staticClass:"help-list"},[e("div",{staticClass:"filter-banner"},[e("div",{staticClass:"filter-container"},[e("div",{staticClass:"filter-section"},[e("div",{staticClass:"filter-title"},[e("i",{staticClass:"el-icon-menu"}),e("span",[t._v("求助分类")])]),e("el-radio-group",{staticClass:"category-buttons",attrs:{size:"medium"},on:{change:t.loadHelps},model:{value:t.selectedCategory,callback:function(e){t.selectedCategory=e},expression:"selectedCategory"}},[e("el-radio-button",{attrs:{label:""}},[e("i",{staticClass:"el-icon-s-grid"}),t._v(" 全部 ")]),e("el-radio-button",{attrs:{label:"拼车服务"}},[e("i",{staticClass:"el-icon-truck"}),t._v(" 拼车服务 ")]),e("el-radio-button",{attrs:{label:"快递代取"}},[e("i",{staticClass:"el-icon-box"}),t._v(" 快递代取 ")]),e("el-radio-button",{attrs:{label:"求购服务"}},[e("i",{staticClass:"el-icon-shopping-cart-2"}),t._v(" 求购服务 ")])],1)],1),t.user?e("div",{staticClass:"publish-section"},[e("el-button",{staticClass:"publish-btn",attrs:{type:"success",icon:"el-icon-plus",size:"medium"},on:{click:function(e){return t.$router.push("/help/publish")}}},[t._v(" 发布求助 ")])],1):t._e()])]),e("div",{staticClass:"helps-container"},[t._l(t.helps,function(s){return e("el-card",{key:s.id,staticClass:"help-card",attrs:{shadow:"hover"}},[e("div",{staticClass:"help-item"},[e("div",{staticClass:"help-header-info"},[e("h3",{staticClass:"help-title"},[t._v(t._s(s.title))]),e("div",{staticClass:"help-tags"},[e("el-tag",{attrs:{type:"info"}},[t._v(t._s(s.category))]),e("el-tag",{staticStyle:{"margin-left":"10px"},attrs:{type:0===s.status?"success":"info"}},[t._v(" "+t._s(0===s.status?"进行中":1===s.status?"已完成":"已取消")+" ")])],1)]),e("p",{staticClass:"description"},[t._v(t._s(s.description))]),e("div",{staticClass:"help-footer"},[e("span",{staticClass:"time"},[t._v(t._s(t.formatTime(s.createTime)))]),e("el-button",{attrs:{size:"medium",type:"primary",icon:"el-icon-message"},on:{click:function(e){return t.startChat(s)}}},[t._v("联系发布者")])],1)])])}),0===t.helps.length?e("el-empty",{attrs:{description:"暂无求助"}}):t._e()],2)])])},ot=[];const nt={components:{Layout:b},name:"HelpList",data(){return{helps:[],selectedCategory:"",user:null}},mounted(){this.user=JSON.parse(localStorage.getItem("user")||"null"),this.loadHelps()},methods:{loadHelps(){const t=this.selectedCategory?{category:this.selectedCategory}:{};this.$http.get("/help/list",{params:t}).then(t=>{t.success&&(this.helps=t.data)})},formatTime(t){return t?new Date(t).toLocaleString("zh-CN"):""},startChat(t){const e=JSON.parse(localStorage.getItem("user")||"null");if(!e)return this.$message.warning("请先登录"),void this.$router.push("/login");e.id!==t.userId?this.$router.push(`/chat/${t.userId}?helpId=${t.id}`):this.$message.warning("不能联系自己")}}},ct=nt;var ut=(0,n.A)(ct,lt,ot,!1,null,"51bce0e6",null);const dt=ut.exports;var pt=function(){var t=this,e=t._self._c;return e("Layout",[e("div",{staticClass:"help-publish"},[e("el-card",[e("div",{attrs:{slot:"header"},slot:"header"},[e("h2",[t._v("发布求助")])]),e("el-form",{ref:"helpForm",staticStyle:{"max-width":"800px"},attrs:{model:t.helpForm,rules:t.rules,"label-width":"120px"}},[e("el-form-item",{attrs:{label:"求助标题",prop:"title"}},[e("el-input",{attrs:{placeholder:"请输入求助标题"},model:{value:t.helpForm.title,callback:function(e){t.$set(t.helpForm,"title",e)},expression:"helpForm.title"}})],1),e("el-form-item",{attrs:{label:"求助分类",prop:"category"}},[e("el-select",{attrs:{placeholder:"请选择分类"},model:{value:t.helpForm.category,callback:function(e){t.$set(t.helpForm,"category",e)},expression:"helpForm.category"}},[e("el-option",{attrs:{label:"拼车服务",value:"拼车服务"}}),e("el-option",{attrs:{label:"快递代取",value:"快递代取"}}),e("el-option",{attrs:{label:"求购服务",value:"求购服务"}})],1)],1),e("el-form-item",{attrs:{label:"求助描述",prop:"description"}},[e("el-input",{attrs:{type:"textarea",rows:5,placeholder:"请输入详细描述"},model:{value:t.helpForm.description,callback:function(e){t.$set(t.helpForm,"description",e)},expression:"helpForm.description"}})],1),e("el-form-item",{attrs:{label:"相关图片"}},[e("el-upload",{attrs:{action:"/api/file/upload","list-type":"picture-card","file-list":t.fileList,"on-preview":t.handlePreview,"on-remove":t.handleRemove,"on-success":t.handleUploadSuccess,"on-error":t.handleUploadError,"before-upload":t.beforeUpload,limit:5}},[e("i",{staticClass:"el-icon-plus"})])],1),e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:t.handleSubmit}},[t._v("发布")]),e("el-button",{on:{click:function(e){return t.$router.back()}}},[t._v("取消")])],1)],1)],1)],1)])},ht=[];const mt={components:{Layout:b},name:"HelpPublish",data(){return{helpForm:{title:"",category:"",description:""},rules:{title:[{required:!0,message:"请输入求助标题",trigger:"blur"}],category:[{required:!0,message:"请选择分类",trigger:"change"}],description:[{required:!0,message:"请输入求助描述",trigger:"blur"}]},fileList:[]}},mounted(){const t=JSON.parse(localStorage.getItem("user")||"null");t||(this.$message.warning("请先登录"),this.$router.push("/login"))},methods:{handlePreview(t){window.open(t.url||t.response?.url,"_blank")},handleRemove(t,e){this.fileList=e},beforeUpload(t){const e=t.type.startsWith("image/"),s=t.size/1024/1024<5;return e?!!s||(this.$message.error("图片大小不能超过 5MB!"),!1):(this.$message.error("只能上传图片文件!"),!1)},handleUploadSuccess(t,e,s){if(t.success){let r=t.url;r.startsWith("/uploads/"),0,this.fileList=s.map(s=>s.uid===e.uid?{...s,url:r,response:t}:s),this.$message.success("图片上传成功")}else this.$message.error(t.message||"上传失败"),this.fileList=s.filter(t=>t.uid!==e.uid)},handleUploadError(t,e,s){this.$message.error("图片上传失败："+(t.message||"网络错误")),this.fileList=s.filter(t=>t.uid!==e.uid)},handleSubmit(){this.$refs.helpForm.validate(t=>{if(t){const t=JSON.parse(localStorage.getItem("user")||"null"),e=this.fileList.map(t=>{const e=t.response?.url;if(e&&!e.startsWith("blob:")&&!e.startsWith("http://"))return e;if(e&&e.startsWith("http://47.108.59.70:8090/uploads/"))return e.replace("http://47.108.59.70:8090","");const s=t.url;return s&&s.startsWith("http://47.108.59.70:8090/uploads/")?s.replace("http://47.108.59.70:8090",""):!s||s.startsWith("blob:")||s.startsWith("http://")?"":s}).filter(t=>t&&""!==t.trim()),s={...this.helpForm,userId:t.id,images:JSON.stringify(e)};this.$http.post("/help/add",s).then(t=>{t.success?(this.$message.success("发布成功"),this.$router.push("/helps")):this.$message.error(t.message)})}})}}},gt=mt;var vt=(0,n.A)(gt,pt,ht,!1,null,"7320a4f0",null);const ft=vt.exports;var yt=function(){var t=this,e=t._self._c;return e("Layout",[e("div",{staticClass:"chat-container"},[e("el-card",[e("div",{staticClass:"chat-header",attrs:{slot:"header"},slot:"header"},[e("el-button",{attrs:{icon:"el-icon-arrow-left",size:"small"},on:{click:function(e){return t.$router.push("/chats")}}},[t._v("返回")]),e("span",{staticClass:"chat-title"},[t._v(t._s(t.targetUser?t.targetUser.realName:"聊天"))])],1),e("div",{staticClass:"chat-main"},[e("div",{ref:"messagesContainer",staticClass:"chat-messages"},t._l(t.messages,function(s){return e("div",{key:s.id,class:["message-item",s.fromUserId===t.currentUserId?"message-right":"message-left"]},[e("div",{staticClass:"message-content"},[e("div",{staticClass:"message-text"},[t._v(t._s(s.content))]),e("div",{staticClass:"message-time"},[t._v(t._s(t.formatTime(s.createTime)))])])])}),0),e("div",{staticClass:"chat-input"},[e("el-input",{attrs:{type:"textarea",rows:3,placeholder:"输入消息..."},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:e.ctrlKey?t.sendMessage.apply(null,arguments):null}},model:{value:t.inputMessage,callback:function(e){t.inputMessage=e},expression:"inputMessage"}}),e("el-button",{staticStyle:{"margin-top":"10px"},attrs:{type:"primary"},on:{click:t.sendMessage}},[t._v("发送")])],1)])])],1)])},bt=[];const _t={components:{Layout:b},name:"Chat",data(){return{messages:[],inputMessage:"",targetUserId:null,currentUserId:null,targetUser:null,productId:null,helpId:null,timer:null}},mounted(){const t=JSON.parse(localStorage.getItem("user")||"null");if(!t)return this.$message.warning("请先登录"),void this.$router.push("/login");this.currentUserId=t.id,this.targetUserId=parseInt(this.$route.params.userId),this.productId=this.$route.query.productId?parseInt(this.$route.query.productId):null,this.helpId=this.$route.query.helpId?parseInt(this.$route.query.helpId):null,this.loadTargetUser(),this.loadMessages(),this.timer=setInterval(()=>{this.loadMessages()},3e3)},beforeDestroy(){this.timer&&clearInterval(this.timer)},methods:{loadTargetUser(){this.$http.get(`/user/${this.targetUserId}`).then(t=>{t.success&&(this.targetUser=t.data)})},loadMessages(){this.$http.get("/chat/history",{params:{userId1:this.currentUserId,userId2:this.targetUserId}}).then(t=>{if(t.success){const e=this.messages.length;this.messages=t.data,this.messages.length>0&&this.$http.put("/chat/readAll",null,{params:{fromUserId:this.targetUserId,toUserId:this.currentUserId}}),this.messages.length>e&&this.$nextTick(()=>{this.scrollToBottom()})}})},sendMessage(){if(!this.inputMessage.trim())return;const t={fromUserId:this.currentUserId,toUserId:this.targetUserId,productId:this.productId,helpId:this.helpId,content:this.inputMessage.trim()};this.$http.post("/chat/send",t).then(t=>{t.success?(this.inputMessage="",this.loadMessages()):this.$message.error(t.message)})},formatTime(t){if(!t)return"";const e=new Date(t),s=new Date,r=s-e;return r<6e4?"刚刚":r<36e5?Math.floor(r/6e4)+"分钟前":r<864e5?Math.floor(r/36e5)+"小时前":e.toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},scrollToBottom(){const t=this.$refs.messagesContainer;t&&(t.scrollTop=t.scrollHeight)}}},Ct=_t;var wt=(0,n.A)(Ct,yt,bt,!1,null,"173b3df7",null);const $t=wt.exports;var It=function(){var t=this,e=t._self._c;return e("Layout",[e("div",{staticClass:"chat-list-page"},[e("el-card",[e("div",{attrs:{slot:"header"},slot:"header"},[e("span",[t._v("我的消息")])]),0===t.chatList.length?e("div",{staticClass:"empty-chats"},[e("el-empty",{attrs:{description:"暂无聊天记录"}})],1):e("div",t._l(t.chatList,function(s){return e("div",{key:s.userId,staticClass:"chat-item",on:{click:function(e){return t.openChat(s.userId)}}},[e("div",{staticClass:"chat-avatar"},[e("i",{staticClass:"el-icon-user-solid"})]),e("div",{staticClass:"chat-info"},[e("div",{staticClass:"chat-name"},[t._v(t._s(s.userName))]),e("div",{staticClass:"chat-preview"},[t._v(t._s(s.lastMessage))])]),e("div",{staticClass:"chat-meta"},[e("div",{staticClass:"chat-time"},[t._v(t._s(t.formatTime(s.lastMessageTime)))]),s.unreadCount>0?e("el-badge",{staticClass:"unread-badge",attrs:{value:s.unreadCount}}):t._e()],1)])}),0)])],1)])},kt=[];const Pt={name:"ChatList",components:{Layout:b},data(){return{chatList:[],user:null,timer:null}},mounted(){if(this.user=JSON.parse(localStorage.getItem("user")||"null"),!this.user)return this.$message.warning("请先登录"),void this.$router.push("/login");this.loadChatList(),this.timer=setInterval(()=>{this.loadChatList()},5e3)},beforeDestroy(){this.timer&&clearInterval(this.timer)},methods:{loadChatList(){this.$http.get(`/chat/unread/${this.user.id}`).then(t=>{if(t.success){const e=t.data||[],s=new Map;e.forEach(t=>{const e=t.fromUserId===this.user.id?t.toUserId:t.fromUserId;s.has(e)||s.set(e,{userId:e,userName:"用户"+e,unreadCount:0,lastMessage:"",lastMessageTime:null});const r=s.get(e);t.toUserId===this.user.id&&0===t.isRead&&r.unreadCount++,(!r.lastMessageTime||new Date(t.createTime)>new Date(r.lastMessageTime))&&(r.lastMessage=t.content,r.lastMessageTime=t.createTime)}),this.$http.get(`/chat/all/${this.user.id}`).then(t=>{if(t.success){t.data.forEach(t=>{const e=t.fromUserId===this.user.id?t.toUserId:t.fromUserId;if(s.has(e)){const r=s.get(e);(!r.lastMessageTime||new Date(t.createTime)>new Date(r.lastMessageTime))&&(r.lastMessage=t.content,r.lastMessageTime=t.createTime)}else s.set(e,{userId:e,userName:"用户"+e,unreadCount:0,lastMessage:t.content,lastMessageTime:t.createTime})});const e=Array.from(s.keys()),r=e.map(t=>this.$http.get(`/user/${t}`).then(e=>{if(e.success){const r=s.get(t);r&&(r.userName=e.data.realName)}}));Promise.all(r).then(()=>{this.chatList=Array.from(s.values()).sort((t,e)=>{const s=t.lastMessageTime?new Date(t.lastMessageTime):new Date(0),r=e.lastMessageTime?new Date(e.lastMessageTime):new Date(0);return r-s})})}}).catch(()=>{this.chatList=Array.from(s.values())})}})},openChat(t){this.$router.push(`/chat/${t}`)},formatTime(t){if(!t)return"";const e=new Date(t),s=new Date,r=s-e;return r<6e4?"刚刚":r<36e5?Math.floor(r/6e4)+"分钟前":r<864e5?Math.floor(r/36e5)+"小时前":e.toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}}},Mt=Pt;var St=(0,n.A)(Mt,It,kt,!1,null,"294e27df",null);const Ft=St.exports;var xt=function(){var t=this,e=t._self._c;return e("Layout",[e("div",{staticClass:"user-center"},[e("el-card",[e("div",{attrs:{slot:"header"},slot:"header"},[e("h2",[t._v("个人中心")])]),e("el-tabs",[e("el-tab-pane",{attrs:{label:"我的商品"}},[e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.myProducts}},[e("el-table-column",{attrs:{prop:"title",label:"标题",width:"200"}}),e("el-table-column",{attrs:{prop:"category",label:"分类",width:"120"}}),e("el-table-column",{attrs:{prop:"price",label:"价格",width:"100"}}),e("el-table-column",{attrs:{prop:"status",label:"状态",width:"100"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-tag",{attrs:{type:0===s.row.status?"success":"info"}},[t._v(" "+t._s(0===s.row.status?"待售":1===s.row.status?"已售":"已下架")+" ")])]}}])}),e("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-button",{attrs:{size:"small"},on:{click:function(e){return t.editProduct(s.row)}}},[t._v("编辑")]),e("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(e){return t.deleteProduct(s.row.id)}}},[t._v("删除")])]}}])})],1)],1),e("el-tab-pane",{attrs:{label:"我的求助"}},[e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.myHelps}},[e("el-table-column",{attrs:{prop:"title",label:"标题",width:"200"}}),e("el-table-column",{attrs:{prop:"category",label:"分类",width:"120"}}),e("el-table-column",{attrs:{prop:"status",label:"状态",width:"100"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-tag",{attrs:{type:0===s.row.status?"success":"info"}},[t._v(" "+t._s(0===s.row.status?"进行中":1===s.row.status?"已完成":"已取消")+" ")])]}}])}),e("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-button",{attrs:{size:"small"},on:{click:function(e){return t.editHelp(s.row)}}},[t._v("编辑")]),e("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(e){return t.deleteHelp(s.row.id)}}},[t._v("删除")])]}}])})],1)],1)],1)],1)],1)])},Lt=[];const Tt={components:{Layout:b},name:"UserCenter",data(){return{myProducts:[],myHelps:[]}},mounted(){const t=JSON.parse(localStorage.getItem("user")||"null");if(!t)return this.$message.warning("请先登录"),void this.$router.push("/login");this.loadMyProducts(t.id),this.loadMyHelps(t.id)},methods:{loadMyProducts(t){this.$http.get(`/product/user/${t}`).then(t=>{t.success&&(this.myProducts=t.data)})},loadMyHelps(t){this.$http.get(`/help/user/${t}`).then(t=>{t.success&&(this.myHelps=t.data)})},editProduct(t){this.$message.info("编辑功能待实现")},deleteProduct(t){this.$confirm("确定要删除这个商品吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$http.delete(`/product/${t}`).then(t=>{if(t.success){this.$message.success("删除成功");const t=JSON.parse(localStorage.getItem("user")||"null");this.loadMyProducts(t.id)}})})},editHelp(t){this.$message.info("编辑功能待实现")},deleteHelp(t){this.$confirm("确定要删除这个求助吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$http.delete(`/help/${t}`).then(t=>{if(t.success){this.$message.success("删除成功");const t=JSON.parse(localStorage.getItem("user")||"null");this.loadMyHelps(t.id)}})})}}},At=Tt;var Ut=(0,n.A)(At,xt,Lt,!1,null,"184b8fd6",null);const Nt=Ut.exports;r["default"].use(d.Ay);const Ot=[{path:"/",name:"Home",component:$},{path:"/login",name:"Login",component:F},{path:"/register",name:"Register",component:N},{path:"/products",name:"ProductList",component:q},{path:"/product/publish",name:"ProductPublish",component:it,meta:{requiresAuth:!0}},{path:"/product/:id",name:"ProductDetail",component:B},{path:"/helps",name:"HelpList",component:dt},{path:"/help/publish",name:"HelpPublish",component:ft,meta:{requiresAuth:!0}},{path:"/chats",name:"ChatList",component:Ft,meta:{requiresAuth:!0}},{path:"/chat/:userId",name:"Chat",component:$t,meta:{requiresAuth:!0}},{path:"/user/center",name:"UserCenter",component:Nt,meta:{requiresAuth:!0}}],Dt=new d.Ay({mode:"history",base:"/",routes:Ot}),Wt=d.Ay.prototype.push;d.Ay.prototype.push=function(t){return Wt.call(this,t).catch(t=>{if("NavigationDuplicated"!==t.name)return Promise.reject(t)})},Dt.beforeEach((t,e,s)=>{const r=JSON.parse(localStorage.getItem("user")||"null");t.meta.requiresAuth&&!r?s("/login"):s()});const zt=Dt;var Ht=s(1052),qt=s.n(Ht),Jt=s(2505),Et=s.n(Jt);r["default"].config.productionTip=!1,r["default"].use(qt()),Et().defaults.baseURL="/api",Et().defaults.timeout=1e4,Et().interceptors.request.use(t=>{const e=localStorage.getItem("token");return e&&(t.headers.Authorization=`Bearer ${e}`),t},t=>Promise.reject(t)),Et().interceptors.response.use(t=>t.data,t=>(t.response&&401===t.response.status&&(localStorage.removeItem("token"),localStorage.removeItem("user"),zt.push("/login").catch(()=>{})),Promise.reject(t))),r["default"].prototype.$http=Et(),new r["default"]({router:zt,render:t=>t(u)}).$mount("#app")}},e={};function s(r){var a=e[r];if(void 0!==a)return a.exports;var i=e[r]={id:r,loaded:!1,exports:{}};return t[r](i,i.exports,s),i.loaded=!0,i.exports}s.m=t,(()=>{s.amdO={}})(),(()=>{var t=[];s.O=(e,r,a,i)=>{if(!r){var l=1/0;for(u=0;u<t.length;u++){for(var[r,a,i]=t[u],o=!0,n=0;n<r.length;n++)(!1&i||l>=i)&&Object.keys(s.O).every(t=>s.O[t](r[n]))?r.splice(n--,1):(o=!1,i<l&&(l=i));if(o){t.splice(u--,1);var c=a();void 0!==c&&(e=c)}}return e}i=i||0;for(var u=t.length;u>0&&t[u-1][2]>i;u--)t[u]=t[u-1];t[u]=[r,a,i]}})(),(()=>{s.n=t=>{var e=t&&t.__esModule?()=>t["default"]:()=>t;return s.d(e,{a:e}),e}})(),(()=>{s.d=(t,e)=>{for(var r in e)s.o(e,r)&&!s.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})}})(),(()=>{s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()})(),(()=>{s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e)})(),(()=>{s.r=t=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}})(),(()=>{s.nmd=t=>(t.paths=[],t.children||(t.children=[]),t)})(),(()=>{var t={524:0};s.O.j=e=>0===t[e];var e=(e,r)=>{var a,i,[l,o,n]=r,c=0;if(l.some(e=>0!==t[e])){for(a in o)s.o(o,a)&&(s.m[a]=o[a]);if(n)var u=n(s)}for(e&&e(r);c<l.length;c++)i=l[c],s.o(t,i)&&t[i]&&t[i][0](),t[i]=0;return s.O(u)},r=self["webpackChunksecondhand_frontend"]=self["webpackChunksecondhand_frontend"]||[];r.forEach(e.bind(null,0)),r.push=e.bind(null,r.push.bind(r))})();var r=s.O(void 0,[504],()=>s(2388));r=s.O(r)})();
//# sourceMappingURL=app.66273d50.js.map